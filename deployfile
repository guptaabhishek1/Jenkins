node{

  def buildNumber = env.BUILD_NUMBER
  def gitToken
      withCredentials([string(credentialsId: 'github_token', variable: 'TOKEN')]) {
          gitToken = env.TOKEN
      }
      
  stage('IntegrationTest') {
    echo 'Testing...'
    echo 'Such build, wow!'
    currentBuild.result = 'SUCCESS'
  }
  

  stage('CheckoutReports') {
          checkout([$class                    : 'GitSCM', branches: [
                    [name: '*/master']
            ], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [
                    [url: 'https://github.com/guptaabhishek1/Jenkins.git']
            ]])
        }

  stage('UpdateBuildStatus') {
        echo "${currentBuild.result}"
        echo "${buildNumber}"
        
        sh """
          date_stamp=`date +%F`
          echo "${date_stamp}"
          cat >"${date_stamp}/build_${buildNumber}/build_reports.json" <<EOF
{
  "buildNumber": "${buildNumber}",
  "buildstatus": "${currentBuild.result}"
}
EOF
        """
        //Pusing files to github
        sh """
           date_stamp=`date +%F`
           git add ${date_stamp}/build_${buildNumber}/build_reports.json
           git commit -m "Updating jenkins json file"
           git push origin HEAD:master
        """

        }

}
