node {
   
    def buildNumber = env.BUILD_NUMBER
    def workspace = env.WORKSPACE

    stage("Git push"){
        checkout scm
        withCredentials([string(credentialsId: 'github_token', variable: 'gittoken')]) {
        
            // Checking out the code from GITHUB
            sh """
               git config --global user.email 'zone.abhishek@gmail.com'
               git config --global user.name 'Abhishek Gupta'
               git clone https://${gittoken}@github.com/guptaabhishek1/Jenkins.git version_update_folde
               cd version_update_folder
               git checkout master
            """
            
            // Updating or Creating  the version file before commit 
            sh """
            cat >jenkins_build.json <<EOF 
{
"version": "${env.BUILD_NUMBER}"
}
EOF
            """
            //Pusing files to github
            sh """
               git add jenkins_build.json
               git commit -m "Updating jenkins json file"
               git push origin HEAD:master
               rm -rf version_update_folder
            """
            
   
    }
    }
   
}
