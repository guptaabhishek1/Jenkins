import groovy.json.JsonSlurperClassic

node {
    echo 'Hello World'
    echo 'This is test'
    def buildNumber = env.BUILD_NUMBER
    def workspace = env.WORKSPACE
    def buildUrl = env.BUILD_URL
    def buildNo = env.BUILD_NO
    def PWD = pwd()
    
    //echo env.GIT_REPO_URL
    //echo env.GIT_COMMIT
    //echo env.GIT_BRANCH
    //echo env.GIT_REVISION
    // PRINT ENVIRONMENT TO JOB
    
    echo "workspace directory is ${workspace}"
    echo "build URL is ${env.BUILD_URL}"
    echo "build No is ${env.BUILD_NUMBER}"
    echo "PWD is ${PWD}"

    stage("Git push"){
        checkout scm
        withCredentials([string(credentialsId: 'github_token', variable: 'gittoken')]) {
        
            // Checking out the code from GITHUB
            sh """
               git config --global user.email 'zone.abhishek@gmail.com'
               git config --global user.name 'Abhishek Gupta'
               git remote set-url origin https://${gittoken}@github.com/guptaabhishek1/Jenkins.git
               git checkout master
            """
            // Updating or Creating  the version file before commit 
            sh """
cat >jenkins_build.json <<EOF 
{
"version": "96"
}
EOF
            """
            //Pusing files to github
            sh """
               git add jenkins_build.json
               git commit -m "Updating jenkins json file"
               git push origin HEAD:master
            """
   
    }
    }
}
