import groovy.json.JsonSlurperClassic

node {
    echo 'Hello World'
    echo 'This is test'
    def buildNumber = env.BUILD_NUMBER
    def workspace = env.WORKSPACE
    def buildUrl = env.BUILD_URL
    def buildNo = env.BUILD_NO
    def PWD = pwd()
    
    echo env.GIT_REPO_URL
    echo env.GIT_COMMIT
    echo env.GIT_BRANCH
    echo env.GIT_REVISION
    
    // PRINT ENVIRONMENT TO JOB
    echo "workspace directory is ${workspace}"
    echo "build URL is ${env.BUILD_URL}"
    echo "build URL is ${env.BUILD_NO}"
    echo "PWD is ${PWD}"

    stage("Git push"){
        sh """
            cat >jenkins_build.json <<EOF
               {
                    "version": "test"
               }
            EOF
        """
        withCredentials([string(credentialsId: 'github_token', variable: 'gittoken')]) {
            sh """
               git config --global user.email 'zone.abhishek@gmail.com'
               git config --global user.name 'Abhishek Gupta'
               git remote set-url origin https://${gittoken}@https://github.com/guptaabhishek1/Jenkins.git
               git checkout master
               git branch
            """
            sh """
               cat >jenkins_build.json <<EOF
               {
                    "version": "test"
               }
               EOF
            """
            sh """
               git add jenkins_build.json
               git commit -m "Updating jenkins json file"
               git push
            """
   
    }
    }
}
