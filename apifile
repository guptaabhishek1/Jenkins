node{

  def ApiUrl = "https://my-json-server.typicode.com/user/repo/posts/1"
      
  stage('FetchApiFile') {
    echo 'Calling API to get event details contents'
    sh """
      curl ${ApiUrl} > /tmp/ApiUrl.txt
      cat /tmp/ApiUrl.txt |grep -w "Event" |head -1 |cut -d "|" -f2 |cut -d " " -f1 
      
    currentBuild.result = 'SUCCESS'
  }
  

  stage('CheckoutReports') {
          checkout([$class                    : 'GitSCM', branches: [
                    [name: '*/master']
            ], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [
                    [url: 'https://github.com/guptaabhishek1/Jenkins.git']
            ]])
        }

  stage('UpdateBuildStatus') {
        echo "${currentBuild.result}"
        echo "${buildNumber}"
        def build_date = sh(script:"date +%F", returnStdout: true).trim()
        sh """

          cat >${build_date}/build_${buildNumber}/build_reports1.json <<EOF
{
  "buildNumber": "${buildNumber}",
  "buildstatus": "${currentBuild.result}"
}
EOF
        """
        //Pusing files to github
        sh """
           git config --global user.email '${EMAIL}'
           git config --global user.name '${USERNAME}'
           git remote set-url origin https://${gitToken}@${GIT_URL}
           git add ${build_date}/build_${buildNumber}/build_reports1.json
           git commit -m "Updating jenkins json file"
           git push origin HEAD:master
        """

        }

}
